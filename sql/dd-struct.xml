<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--
     You can run this change log on your database as many times as you want, it will ignore the
     changes that are already applied. It also means that you can't modify an existing revision.
     Always add to the end.

     Use the maven goals: liquibase:update and liquibase:status
      Potentially with -Dliquibase.dropFirst=true
     $Id$
 -->
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet author="roug" id="rev-1">
        <createTable tableName="ACL_ROWS">
            <column defaultValueNumeric="0" name="ACL_ID" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'object'" name="TYPE" type="enum('object','doc','dcc')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'user'" name="ENTRY_TYPE" type="enum('owner','user','localgroup','other','foreign','unauthenticated','authenticated','mask')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PRINCIPAL" type="CHAR(16)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="PERMISSIONS" type="CHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="STATUS" type="INT(1)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-2">
        <createTable tableName="ACLS">
            <column name="ACL_ID" type="INT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="ACL_NAME" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="PARENT_NAME" type="VARCHAR(100)"/>
            <column defaultValue="" name="OWNER" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="DESCRIPTION" type="VARCHAR(255)"/>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-3">
        <createTable tableName="ATTRIBUTE">
            <column defaultValueNumeric="0" name="M_ATTRIBUTE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DATAELEM_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="VALUE" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'E'" name="PARENT_TYPE" type="enum('E','T','DS','SCH','SCS')">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-4">
        <createTable tableName="CACHE">
            <column defaultValueNumeric="0" name="OBJ_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'dst'" name="OBJ_TYPE" type="enum('dst','tbl','elm')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'pdf'" name="ARTICLE" type="enum('pdf','xls','xform','xmlinst')">
                <constraints nullable="false"/>
            </column>
            <column name="FILENAME" type="VARCHAR(255)"/>
            <column defaultValueNumeric="0" name="CREATED" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-5">
        <createTable tableName="COMPLEX_ATTR_FIELD">
            <column defaultValueNumeric="0" name="M_COMPLEX_ATTR_FIELD_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="VALUE" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="ROW_ID" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-6">
        <createTable tableName="COMPLEX_ATTR_ROW">
            <column defaultValueNumeric="0" name="PARENT_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'E'" name="PARENT_TYPE" type="enum('E','C','DS','FV','T','SCH','SCS')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="M_COMPLEX_ATTR_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="POSITION" type="INT(3)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="ROW_ID" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="HARV_ATTR_ID" type="VARCHAR(32)"/>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-7">
        <createTable tableName="DATAELEM">
            <column defaultValue="'CH2'" name="TYPE" type="enum('CH1','CH2')">
                <constraints nullable="false"/>
            </column>
            <column name="DATAELEM_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValueNumeric="1" name="NAMESPACE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="SHORT_NAME" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="WORKING_USER" type="VARCHAR(255)"/>
            <column defaultValue="'N'" name="WORKING_COPY" type="enum('Y','N')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'Incomplete'" name="REG_STATUS" type="enum('Recorded','Qualified','Released','Incomplete','Candidate')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="1" name="VERSION" type="INT(4) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="USER" type="VARCHAR(255)"/>
            <column defaultValueNumeric="0" name="DATE" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="PARENT_NS" type="INT(10)"/>
            <column name="TOP_NS" type="INT(10)"/>
            <column defaultValue="" name="IDENTIFIER" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="NULL" name="GIS" type="enum('','class','subclass','subtype')"/>
            <column defaultValue="'true'" name="IS_ROD_PARAM" type="enum('true','false')">
                <constraints nullable="false"/>
            </column>
            <column name="CHECKEDOUT_COPY_ID" type="INT UNSIGNED"/>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-8">
        <createTable tableName="DATASET">
            <column name="DATASET_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="SHORT_NAME" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="1" name="VERSION" type="INT(4) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="VISUAL" type="TEXT"/>
            <column name="DETAILED_VISUAL" type="TEXT"/>
            <column name="WORKING_USER" type="VARCHAR(255)"/>
            <column defaultValue="'N'" name="WORKING_COPY" type="enum('Y','N')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'Incomplete'" name="REG_STATUS" type="enum('Recorded','Qualified','Released','Incomplete','Candidate')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DATE" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="USER" type="VARCHAR(255)"/>
            <column defaultValueNumeric="0" name="CORRESP_NS" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="DELETED" type="VARCHAR(255)"/>
            <column defaultValue="" name="IDENTIFIER" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="43" name="DISP_CREATE_LINKS" type="INT(2)">
                <constraints nullable="false"/>
            </column>
            <column name="CHECKEDOUT_COPY_ID" type="INT UNSIGNED"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-9">
        <createTable tableName="DOC">
            <column defaultValueNumeric="0" name="OWNER_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'dst'" name="OWNER_TYPE" type="enum('dst','tbl','elm')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="MD5_PATH" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="ABS_PATH" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="TITLE" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-10">
        <createTable tableName="documentation">
            <column name="page_id" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="text/html" name="content_type" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="title" type="VARCHAR(512)"/>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-11">
        <createTable tableName="DS_TABLE">
            <column name="TABLE_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="SHORT_NAME" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="WORKING_USER" type="VARCHAR(255)"/>
            <column defaultValue="'N'" name="WORKING_COPY" type="enum('Y','N')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="1" name="VERSION" type="INT(4) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DATE" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="USER" type="VARCHAR(255)"/>
            <column defaultValueNumeric="0" name="CORRESP_NS" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="PARENT_NS" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="IDENTIFIER" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-12">
        <createTable tableName="DST2ROD">
            <column defaultValueNumeric="0" name="DATASET_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="ACTIVITY_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-13">
        <createTable tableName="DST2TBL">
            <column defaultValueNumeric="0" name="DATASET_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="TABLE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="POSITION" type="INT(3) UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-14">
        <createTable tableName="FK_RELATION">
            <column name="REL_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValueNumeric="0" name="A_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="B_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'1'" name="A_CARDIN" type="enum('0','1','+','*')"/>
            <column defaultValue="'1'" name="B_CARDIN" type="enum('0','1','+','*')"/>
            <column name="DEFINITION" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-15">
        <createTable tableName="FXV">
            <column name="FXV_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValueNumeric="0" name="OWNER_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'elem'" name="OWNER_TYPE" type="enum('elem','attr')">
                <constraints nullable="false"/>
            </column>
            <column name="VALUE" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'N'" name="IS_DEFAULT" type="enum('Y','N')">
                <constraints nullable="false"/>
            </column>
            <column name="DEFINITION" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="SHORT_DESC" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-16">
        <createTable tableName="HARV_ATTR">
            <column defaultValue="" name="HARV_ATTR_ID" type="VARCHAR(150)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="HARVESTER_ID" type="VARCHAR(150)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="HARVESTED" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="MD5KEY" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="LOGICAL_ID" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-17">
        <createTable tableName="HARV_ATTR_FIELD">
            <column defaultValue="" name="HARV_ATTR_MD5" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="FLD_NAME" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="FLD_VALUE" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-18">
        <createTable tableName="HLP_AREA">
            <column defaultValue="" name="AREA_ID" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="SCREEN_ID" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="LANGUAGE" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="HTML" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="MD5" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="400" name="POPUP_WIDTH" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="400" name="POPUP_LENGTH" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-19">
        <createTable tableName="HLP_SCREEN">
            <column defaultValue="" name="SCREEN_ID" type="VARCHAR(100)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="DESCRIPTION" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-20">
        <createTable tableName="M_ATTRIBUTE">
            <column name="M_ATTRIBUTE_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'M'" name="OBLIGATION" type="enum('M','O','C')">
                <constraints nullable="false"/>
            </column>
            <column name="DEFINITION" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="SHORT_NAME" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="44" name="NAMESPACE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'text'" name="DISP_TYPE" type="enum('text','textarea','select','image')"/>
            <column defaultValueNumeric="999" name="DISP_ORDER" type="INT(3) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="31" name="DISP_WHEN" type="INT(2) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="20" name="DISP_WIDTH" type="INT(3) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="1" name="DISP_HEIGHT" type="INT(3) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'0'" name="DISP_MULTIPLE" type="enum('0','1')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'0'" name="INHERIT" type="enum('0','1','2')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="LANGUAGE_USED" type="TINYINT(1)"/>
            <column defaultValue="NULL" name="DATA_TYPE" type="enum('reference','','string','integer','decimal','boolean','dateTime','date')"/>
            <column name="RDF_PROPERTY" type="VARCHAR(100)"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-21">
        <createTable tableName="M_COMPLEX_ATTR">
            <column name="M_COMPLEX_ATTR_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'O'" name="OBLIGATION" type="enum('M','O','C')">
                <constraints nullable="false"/>
            </column>
            <column name="DEFINITION" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="SHORT_NAME" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="1" name="NAMESPACE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="999" name="DISP_ORDER" type="INT(3) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'7'" name="DISP_WHEN" type="enum('1','2','3','4','5','6','7')">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'0'" name="INHERIT" type="enum('0','1','2')">
                <constraints nullable="false"/>
            </column>
            <column name="HARVESTER_ID" type="VARCHAR(225)"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-22">
        <createTable tableName="M_COMPLEX_ATTR_FIELD">
            <column defaultValueNumeric="0" name="M_COMPLEX_ATTR_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="M_COMPLEX_ATTR_FIELD_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="DEFINITION" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="POSITION" type="INT(2)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'0'" name="PRIORITY" type="enum('0','1')">
                <constraints nullable="false"/>
            </column>
            <column name="HARV_ATTR_FLD_NAME" type="VARCHAR(200)"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-23">
        <createTable tableName="NAMESPACE">
            <column name="NAMESPACE_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="SHORT_NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="FULL_NAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="DEFINITION" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="PARENT_NS" type="INT UNSIGNED"/>
            <column name="WORKING_USER" type="VARCHAR(255)"/>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-24">
        <createTable tableName="ROD_ACTIVITIES">
            <column defaultValueNumeric="0" name="ACTIVITY_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="ACTIVITY_TITLE" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="LEGINSTR_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="LEGINSTR_TITLE" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-25">
        <createTable tableName="SCHEMA">
            <column name="SCHEMA_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="FILENAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="SCHEMA_SET_ID" type="INT UNSIGNED"/>
            <column name="CONTINUITY_ID" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'Draft'" name="REG_STATUS" type="enum('Draft','Released')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="WORKING_COPY" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="WORKING_USER" type="VARCHAR(50)"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="DATE" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="USER" type="VARCHAR(50)"/>
            <column name="COMMENT" type="TEXT"/>
            <column name="CHECKEDOUT_COPY_ID" type="INT UNSIGNED"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-26">
        <createTable tableName="SCHEMA_SET">
            <column name="SCHEMA_SET_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="IDENTIFIER" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="CONTINUITY_ID" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'Draft'" name="REG_STATUS" type="enum('Draft','Released')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="WORKING_COPY" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="WORKING_USER" type="VARCHAR(50)"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="DATE" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="USER" type="VARCHAR(50)"/>
            <column name="COMMENT" type="TEXT"/>
            <column name="CHECKEDOUT_COPY_ID" type="INT UNSIGNED"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-27">
        <createTable tableName="T_SCHEMA">
            <column name="SCHEMA_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="FILENAME" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="SCHEMA_SET_ID" type="INT UNSIGNED"/>
            <column name="CONTINUITY_ID" type="VARCHAR(36)"/>
            <column defaultValue="NULL" name="REG_STATUS" type="enum('Draft','Public draft','Released')"/>
            <column defaultValueNumeric="0" name="WORKING_COPY" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="WORKING_USER" type="VARCHAR(50)"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="DATE_MODIFIED" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="USER_MODIFIED" type="VARCHAR(50)"/>
            <column name="COMMENT" type="TEXT"/>
            <column name="CHECKEDOUT_COPY_ID" type="INT UNSIGNED"/>
            <column defaultValueNumeric="0" name="OTHER_DOCUMENT" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-28">
        <createTable tableName="T_SCHEMA_SET">
            <column name="SCHEMA_SET_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="IDENTIFIER" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="CONTINUITY_ID" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="NULL" name="REG_STATUS" type="enum('Draft','Public draft','Released')"/>
            <column defaultValueNumeric="0" name="WORKING_COPY" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="WORKING_USER" type="VARCHAR(50)"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="DATE_MODIFIED" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="USER_MODIFIED" type="VARCHAR(50)"/>
            <column name="COMMENT" type="TEXT"/>
            <column name="CHECKEDOUT_COPY_ID" type="INT UNSIGNED"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-29">
        <createTable tableName="T_SITE_CODE">
            <column name="SITE_CODE_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="VOCABULARY_CONCEPT_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="SITE_CODE" type="VARCHAR(100)"/>
            <column name="INITIAL_SITE_NAME" type="VARCHAR(200)"/>
            <column name="SITE_CODE_NAT" type="VARCHAR(30)"/>
            <column defaultValue="'AVAILABLE'" name="STATUS" type="enum('AVAILABLE','ALLOCATED','ASSIGNED','DELETED','DISAPPEARED')">
                <constraints nullable="false"/>
            </column>
            <column name="CC_ISO2" type="CHAR(2)"/>
            <column name="PARENT_ISO" type="CHAR(3)"/>
            <column name="DATE_CREATED" type="DATETIME"/>
            <column name="USER_CREATED" type="VARCHAR(50)"/>
            <column name="DATE_ALLOCATED" type="DATETIME"/>
            <column name="USER_ALLOCATED" type="VARCHAR(50)"/>
            <column name="DATE_DELETED" type="YEAR"/>
            <column name="YEARS_DELETED" type="VARCHAR(100)"/>
            <column name="YEARS_DISAPPEARED" type="VARCHAR(100)"/>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-30">
        <createTable tableName="T_VOCABULARY_CONCEPT">
            <column name="VOCABULARY_CONCEPT_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="VOCABULARY_FOLDER_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="IDENTIFIER" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="LABEL" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="DEFINITION" type="TEXT"/>
            <column name="NOTATION" type="VARCHAR(50)"/>
            <column name="ORIGINAL_CONCEPT_ID" type="INT UNSIGNED"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-31">
        <createTable tableName="T_VOCABULARY_CONCEPT_ATTRIBUTE">
            <column name="ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="M_ATTRIBUTE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="VOCABULARY_CONCEPT_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="ATTR_VALUE" type="TEXT"/>
            <column name="LANGUAGE" type="VARCHAR(10)"/>
            <column name="LINK_TEXT" type="VARCHAR(255)"/>
            <column name="RELATED_CONCEPT_ID" type="INT UNSIGNED"/>
        </createTable>
        <modifySql dbms="mysql">
             <replace replace="LONGTEXT" with="text"/>
         </modifySql>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-32">
        <createTable tableName="T_VOCABULARY_FOLDER">
            <column name="VOCABULARY_FOLDER_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="CONTINUITY_ID" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="IDENTIFIER" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="LABEL" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="'Draft'" name="REG_STATUS" type="enum('Draft','Public draft','Released')">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="WORKING_COPY" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="CHECKEDOUT_COPY_ID" type="INT UNSIGNED"/>
            <column name="WORKING_USER" type="VARCHAR(50)"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="DATE_MODIFIED" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="USER_MODIFIED" type="VARCHAR(50)"/>
            <column defaultValueNumeric="0" name="CONCEPT_IDENTIFIER_NUMERIC" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="BASE_URI" type="VARCHAR(255)"/>
            <column defaultValue="COMMON" name="VOCABULARY_TYPE" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="common" name="FOLDER_NAME" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-33">
        <createTable tableName="TBL2ELEM">
            <column defaultValueNumeric="0" name="TABLE_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="DATAELEM_ID" type="INT UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="POSITION" type="INT(3) UNSIGNED">
                <constraints nullable="false"/>
            </column>
            <column name="MULTIVAL_DELIM" type="VARCHAR(1)"/>
            <column defaultValueNumeric="0" name="MANDATORY" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="PRIM_KEY" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
             <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="roug" id="rev-35">
        <addPrimaryKey columnNames="ACL_ID, TYPE, ENTRY_TYPE, PRINCIPAL, STATUS" tableName="ACL_ROWS"/>
    </changeSet>

    <changeSet author="roug" id="rev-36">
        <addPrimaryKey columnNames="OBJ_ID, OBJ_TYPE, ARTICLE" tableName="CACHE"/>
    </changeSet>

    <changeSet author="roug" id="rev-37">
        <addPrimaryKey columnNames="HARV_ATTR_ID, HARVESTER_ID, HARVESTED" tableName="HARV_ATTR"/>
    </changeSet>

    <changeSet author="roug" id="rev-38">
        <sql>ALTER TABLE HARV_ATTR_FIELD ADD PRIMARY KEY  (HARV_ATTR_MD5,FLD_NAME,FLD_VALUE(200))</sql>
    </changeSet>

    <changeSet author="roug" id="rev-39">
        <addPrimaryKey columnNames="AREA_ID, SCREEN_ID, LANGUAGE" tableName="HLP_AREA"/>
    </changeSet>

    <changeSet author="roug" id="rev-41">
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_CONCEPT_ID" baseTableName="T_SITE_CODE"
        constraintName="FK_VOCABULARY_CONCEPT_ID" deferrable="false" initiallyDeferred="false"
        onDelete="CASCADE"
        referencedColumnNames="VOCABULARY_CONCEPT_ID" referencedTableName="T_VOCABULARY_CONCEPT" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="roug" id="rev-42">
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_FOLDER_ID" baseTableName="T_VOCABULARY_CONCEPT"
        constraintName="FK_VOCABULARY_FOLDER_ID" deferrable="false" initiallyDeferred="false"
        onDelete="CASCADE" onUpdate="CASCADE"
        referencedColumnNames="VOCABULARY_FOLDER_ID" referencedTableName="T_VOCABULARY_FOLDER" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="roug" id="rev-43">
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_CONCEPT_ID" baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE"
        constraintName="FK_CONCEPT_ATTRIBUTE_ID" deferrable="false" initiallyDeferred="false"
        onDelete="CASCADE" onUpdate="CASCADE"
        referencedColumnNames="VOCABULARY_CONCEPT_ID" referencedTableName="T_VOCABULARY_CONCEPT" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="roug" id="rev-44">
        <addForeignKeyConstraint baseColumnNames="M_ATTRIBUTE_ID" baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE"
        constraintName="FK_M_ATTRIBUTE_ATTRIBUTE_ID" deferrable="false" initiallyDeferred="false"
        onDelete="CASCADE" onUpdate="CASCADE"
        referencedColumnNames="M_ATTRIBUTE_ID" referencedTableName="M_ATTRIBUTE" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="roug" id="rev-45">
        <addForeignKeyConstraint baseColumnNames="RELATED_CONCEPT_ID" baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE"
        constraintName="FK_RELATED_CONCEPT_ID" deferrable="false" initiallyDeferred="false"
        onDelete="CASCADE" onUpdate="CASCADE"
        referencedColumnNames="VOCABULARY_CONCEPT_ID" referencedTableName="T_VOCABULARY_CONCEPT" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="roug" id="rev-46">
        <createIndex indexName="ACL_NAME" tableName="ACLS" unique="true">
            <column name="ACL_NAME"/>
            <column name="PARENT_NAME"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-47">
        <sql>ALTER TABLE ATTRIBUTE ADD UNIQUE KEY ATTRIBUTE_UNIQUE (DATAELEM_ID,PARENT_TYPE,M_ATTRIBUTE_ID,VALUE(255))</sql>
    </changeSet>

    <changeSet author="roug" id="rev-48">
        <createIndex indexName="DATAELEM_ID" tableName="ATTRIBUTE" unique="false">
            <column name="DATAELEM_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-49">
        <createIndex indexName="PARENT_TYPE" tableName="ATTRIBUTE" unique="false">
            <column name="PARENT_TYPE"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-50">
        <createIndex indexName="M_ATTRIBUTE_ID" tableName="ATTRIBUTE" unique="false">
            <column name="M_ATTRIBUTE_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-51">
        <createIndex indexName="COMPLEX_ATTR_FIELD_UNIQUE" tableName="COMPLEX_ATTR_FIELD" unique="true">
            <column name="ROW_ID"/>
            <column name="M_COMPLEX_ATTR_FIELD_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-52">
        <createIndex indexName="ROW_ID" tableName="COMPLEX_ATTR_FIELD" unique="false">
            <column name="ROW_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-53">
        <createIndex indexName="M_COMPLEX_ATTR_FIELD_ID" tableName="COMPLEX_ATTR_FIELD" unique="false">
            <column name="M_COMPLEX_ATTR_FIELD_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-54">
        <createIndex indexName="ROW_ID" tableName="COMPLEX_ATTR_ROW" unique="true">
            <column name="ROW_ID"/>
        </createIndex>
        <createIndex indexName="PARENT_ID" tableName="COMPLEX_ATTR_ROW" unique="false">
            <column name="PARENT_ID"/>
        </createIndex>
        <createIndex indexName="PARENT_TYPE" tableName="COMPLEX_ATTR_ROW" unique="false">
            <column name="PARENT_TYPE"/>
        </createIndex>
        <createIndex indexName="M_COMPLEX_ATTR_ID" tableName="COMPLEX_ATTR_ROW" unique="false">
            <column name="M_COMPLEX_ATTR_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-58">
        <createIndex indexName="IDENTIFIER" tableName="DATAELEM" unique="false">
            <column name="IDENTIFIER"/>
        </createIndex>
        <createIndex indexName="SHORT_NAME" tableName="DATAELEM" unique="false">
            <column name="SHORT_NAME"/>
        </createIndex>
        <createIndex indexName="PARENT_NS" tableName="DATAELEM" unique="false">
            <column name="PARENT_NS"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-61">
        <createIndex indexName="IDENTIFIER" tableName="DATASET" unique="false">
            <column name="IDENTIFIER"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-62">
        <createIndex indexName="SHORT_NAME" tableName="DATASET" unique="false">
            <column name="SHORT_NAME"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-63">
        <createIndex indexName="CORRESP_NS" tableName="DATASET" unique="false">
            <column name="CORRESP_NS"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-64">
        <createIndex indexName="DOC_UNIQUE" tableName="DOC" unique="true">
            <column name="OWNER_ID"/>
            <column name="OWNER_TYPE"/>
            <column name="MD5_PATH"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-65">
        <createIndex indexName="OWNER_ID" tableName="DOC" unique="false">
            <column name="OWNER_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-66">
        <createIndex indexName="OWNER_TYPE" tableName="DOC" unique="false">
            <column name="OWNER_TYPE"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-67">
        <createIndex indexName="DATASET_ID" tableName="DST2ROD" unique="false">
            <column name="DATASET_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-68">
        <createIndex indexName="ACTIVITY_ID" tableName="DST2ROD" unique="false">
            <column name="ACTIVITY_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-69">
        <createIndex indexName="DST2ROD_UNIQUE" tableName="DST2ROD" unique="true">
            <column name="DATASET_ID"/>
            <column name="ACTIVITY_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-70">
        <createIndex indexName="DATASET_ID" tableName="DST2TBL" unique="false">
            <column name="DATASET_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-71">
        <createIndex indexName="DST2TBL_UNIQUE" tableName="DST2TBL" unique="true">
            <column name="DATASET_ID"/>
            <column name="TABLE_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-72">
        <createIndex indexName="TABLE_ID" tableName="DST2TBL" unique="false">
            <column name="TABLE_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-73">
        <createIndex indexName="IDENTIFIER" tableName="DS_TABLE" unique="false">
            <column name="IDENTIFIER"/>
        </createIndex>
        <createIndex indexName="SHORT_NAME" tableName="DS_TABLE" unique="false">
            <column name="SHORT_NAME"/>
        </createIndex>
        <createIndex indexName="CORRESP_NS" tableName="DS_TABLE" unique="false">
            <column name="CORRESP_NS"/>
        </createIndex>
        <createIndex indexName="PARENT_NS" tableName="DS_TABLE" unique="false">
            <column name="PARENT_NS"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-77">
        <createIndex indexName="A_ID" tableName="FK_RELATION" unique="false">
            <column name="A_ID"/>
        </createIndex>
        <createIndex indexName="B_ID" tableName="FK_RELATION" unique="false">
            <column name="B_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-79">
        <sql>ALTER TABLE FXV ADD UNIQUE KEY FXV_UNIQUE (OWNER_ID,OWNER_TYPE,VALUE(255))</sql>
    </changeSet>

    <changeSet author="roug" id="rev-80">
        <sql>ALTER TABLE FXV ADD UNIQUE KEY OWNER_ID (OWNER_ID,OWNER_TYPE,VALUE(255))</sql>
    </changeSet>

    <changeSet author="roug" id="rev-81">
        <createIndex indexName="OWNER_TYPE" tableName="FXV" unique="false">
            <column name="OWNER_TYPE"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-82">
        <createIndex indexName="FILENAME" tableName="SCHEMA" unique="false">
            <column name="FILENAME"/>
        </createIndex>
        <createIndex indexName="SCHEMA_SET_ID" tableName="SCHEMA" unique="false">
            <column name="SCHEMA_SET_ID"/>
        </createIndex>
        <createIndex indexName="CONTINUITY_ID" tableName="SCHEMA" unique="false">
            <column name="CONTINUITY_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-85">
        <createIndex indexName="IDENTIFIER" tableName="SCHEMA_SET" unique="false">
            <column name="IDENTIFIER"/>
        </createIndex>
        <createIndex indexName="CONTINUITY_ID" tableName="SCHEMA_SET" unique="false">
            <column name="CONTINUITY_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-87">
        <createIndex indexName="TBL2ELEM_UNIQUE" tableName="TBL2ELEM" unique="true">
            <column name="TABLE_ID"/>
            <column name="DATAELEM_ID"/>
        </createIndex>
        <createIndex indexName="TABLE_ID" tableName="TBL2ELEM" unique="false">
            <column name="TABLE_ID"/>
        </createIndex>
        <createIndex indexName="DATAELEM_ID" tableName="TBL2ELEM" unique="false">
            <column name="DATAELEM_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-91">
        <createIndex indexName="FILENAME" tableName="T_SCHEMA" unique="false">
            <column name="FILENAME"/>
        </createIndex>
        <createIndex indexName="CONTINUITY_ID" tableName="T_SCHEMA" unique="false">
            <column name="CONTINUITY_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-92">
        <addForeignKeyConstraint baseColumnNames="SCHEMA_SET_ID" baseTableName="T_SCHEMA"
        constraintName="FK_SCHEMA_SET_ID" deferrable="false" initiallyDeferred="false"
        onDelete="CASCADE" onUpdate="CASCADE" referencedColumnNames="SCHEMA_SET_ID" referencedTableName="T_SCHEMA_SET" referencesUniqueColumn="false"/>
    </changeSet>

    <changeSet author="roug" id="rev-93">
        <createIndex indexName="IDENTIFIER" tableName="T_SCHEMA_SET" unique="false">
            <column name="IDENTIFIER"/>
        </createIndex>
        <createIndex indexName="CONTINUITY_ID" tableName="T_SCHEMA_SET" unique="false">
            <column name="CONTINUITY_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-95">
        <createIndex indexName="UNIQUE_CONCEPT" tableName="T_VOCABULARY_CONCEPT" unique="true">
            <column name="VOCABULARY_FOLDER_ID"/>
            <column name="IDENTIFIER"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-96">
        <createIndex indexName="UNIQUE_VOCABULARY" tableName="T_VOCABULARY_FOLDER" unique="true">
            <column name="FOLDER_NAME"/>
            <column name="IDENTIFIER"/>
            <column name="WORKING_COPY"/>
        </createIndex>
        <createIndex indexName="IDENTIFIER" tableName="T_VOCABULARY_FOLDER" unique="false">
            <column name="IDENTIFIER"/>
        </createIndex>
        <createIndex indexName="FOLDER_NAME" tableName="T_VOCABULARY_FOLDER" unique="false">
            <column name="FOLDER_NAME"/>
        </createIndex>
    </changeSet>

    <changeSet author="roug" id="rev-99">
        <sql>ALTER TABLE T_VOCABULARY_CONCEPT ADD COLUMN OBSOLETE_DATE timestamp NULL default NULL;
             ALTER TABLE T_VOCABULARY_CONCEPT ADD COLUMN CREATION_DATE timestamp NOT NULL default now();
             UPDATE T_VOCABULARY_CONCEPT SET CREATION_DATE = now()</sql>
    </changeSet>

    <changeSet author="roug" id="rev-100" >
        <validCheckSum>3:21693a0c478ad24dac451d622ddc53bc</validCheckSum>
        <comment>Auto increments can't be added in the create table change set.</comment>
        <addAutoIncrement tableName="ACLS" columnName="ACL_ID" columnDataType="INT"/>
        <addAutoIncrement tableName="DATAELEM" columnName="DATAELEM_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="DATASET" columnName="DATASET_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="DS_TABLE" columnName="TABLE_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="FK_RELATION" columnName="REL_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="FXV" columnName="FXV_ID" columnDataType="INT UNSIGNED"/>

        <dropForeignKeyConstraint baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE" constraintName="FK_M_ATTRIBUTE_ATTRIBUTE_ID"/>
        <addAutoIncrement tableName="M_ATTRIBUTE" columnName="M_ATTRIBUTE_ID" columnDataType="INT UNSIGNED"/>
        <addForeignKeyConstraint baseColumnNames="M_ATTRIBUTE_ID" baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE" 
                constraintName="FK_M_ATTRIBUTE_ATTRIBUTE_ID" deferrable="false" initiallyDeferred="false"
                onDelete="CASCADE" onUpdate="CASCADE"
                referencedColumnNames="M_ATTRIBUTE_ID" referencedTableName="M_ATTRIBUTE" referencesUniqueColumn="false"/>

        <addAutoIncrement tableName="M_COMPLEX_ATTR" columnName="M_COMPLEX_ATTR_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="M_COMPLEX_ATTR_FIELD" columnName="M_COMPLEX_ATTR_FIELD_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="NAMESPACE" columnName="NAMESPACE_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="SCHEMA" columnName="SCHEMA_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="SCHEMA_SET" columnName="SCHEMA_SET_ID" columnDataType="INT UNSIGNED"/>
        <addAutoIncrement tableName="T_SCHEMA" columnName="SCHEMA_ID" columnDataType="INT UNSIGNED"/>

        <dropForeignKeyConstraint baseTableName="T_SCHEMA" constraintName="FK_SCHEMA_SET_ID"/>
        <addAutoIncrement tableName="T_SCHEMA_SET" columnName="SCHEMA_SET_ID" columnDataType="INT UNSIGNED"/>
        <addForeignKeyConstraint baseColumnNames="SCHEMA_SET_ID" baseTableName="T_SCHEMA"
                constraintName="FK_SCHEMA_SET_ID" deferrable="false" initiallyDeferred="false"
                onDelete="CASCADE" onUpdate="CASCADE" referencedColumnNames="SCHEMA_SET_ID" referencedTableName="T_SCHEMA_SET" referencesUniqueColumn="false"/>

        <addAutoIncrement tableName="T_SITE_CODE" columnName="SITE_CODE_ID" columnDataType="INT UNSIGNED"/>

        <dropForeignKeyConstraint baseTableName="T_SITE_CODE" constraintName="FK_VOCABULARY_CONCEPT_ID"/>
        <dropForeignKeyConstraint baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE" constraintName="FK_CONCEPT_ATTRIBUTE_ID"/>
        <dropForeignKeyConstraint baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE" constraintName="FK_RELATED_CONCEPT_ID"/>
        <addAutoIncrement tableName="T_VOCABULARY_CONCEPT" columnName="VOCABULARY_CONCEPT_ID" columnDataType="INT UNSIGNED"/>
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_CONCEPT_ID" baseTableName="T_SITE_CODE"
                constraintName="FK_VOCABULARY_CONCEPT_ID" deferrable="false" initiallyDeferred="false"
                onDelete="CASCADE"
                referencedColumnNames="VOCABULARY_CONCEPT_ID" referencedTableName="T_VOCABULARY_CONCEPT" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_CONCEPT_ID" baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE"
                constraintName="FK_CONCEPT_ATTRIBUTE_ID" deferrable="false" initiallyDeferred="false"
                onDelete="CASCADE" onUpdate="CASCADE"
                referencedColumnNames="VOCABULARY_CONCEPT_ID" referencedTableName="T_VOCABULARY_CONCEPT" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="RELATED_CONCEPT_ID" baseTableName="T_VOCABULARY_CONCEPT_ATTRIBUTE"
                constraintName="FK_RELATED_CONCEPT_ID" deferrable="false" initiallyDeferred="false"
                onDelete="CASCADE" onUpdate="CASCADE"
                referencedColumnNames="VOCABULARY_CONCEPT_ID" referencedTableName="T_VOCABULARY_CONCEPT" referencesUniqueColumn="false"/>

        <addAutoIncrement tableName="T_VOCABULARY_CONCEPT_ATTRIBUTE" columnName="ID" columnDataType="INT UNSIGNED"/>

        <dropForeignKeyConstraint baseTableName="T_VOCABULARY_CONCEPT" constraintName="FK_VOCABULARY_FOLDER_ID"/>
        <addAutoIncrement tableName="T_VOCABULARY_FOLDER" columnName="VOCABULARY_FOLDER_ID" columnDataType="INT UNSIGNED"/>
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_FOLDER_ID" baseTableName="T_VOCABULARY_CONCEPT"
                constraintName="FK_VOCABULARY_FOLDER_ID" deferrable="false" initiallyDeferred="false"
                onDelete="CASCADE" onUpdate="CASCADE"
                referencedColumnNames="VOCABULARY_FOLDER_ID" referencedTableName="T_VOCABULARY_FOLDER" referencesUniqueColumn="false"/>
    </changeSet>

    <!-- Dropping the second of two identical indexes on FXV. See roug@rev-80 -->
    <changeSet author="roug" id="rev-101">
        <comment>Dropping the second of two identical indexes on FXV. See roug@rev-80</comment>
        <dropIndex indexName="OWNER_ID" tableName="FXV" />
    </changeSet>

    <changeSet author="voolajuh" id="rev-102">
        <comment>Changes attribute column's enum declaration.</comment>
        <sql>alter table ATTRIBUTE change column PARENT_TYPE PARENT_TYPE enum('E','T','DS','SCH','SCS','VCF') NOT NULL default 'E';</sql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-103">
        <comment>Create folder table.</comment>
        <sql>CREATE TABLE T_FOLDER (
            ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
            IDENTIFIER VARCHAR(255) NOT NULL,
            LABEL VARCHAR(255) NOT NULL,
            PRIMARY KEY (ID),
            UNIQUE INDEX UNIQUE_FOLDER (IDENTIFIER)
            );
        </sql>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8" />
        </modifySql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-104">
        <comment>Insert folders from T_VOCABULARY_FOLDER to T_FOLDER.</comment>
        <sql>
            insert into T_FOLDER (IDENTIFIER, LABEL) (
                select distinct FOLDER_NAME, FOLDER_NAME from T_VOCABULARY_FOLDER
            );
        </sql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-105">
        <comment>Add folder_id for vocabulary folder table.</comment>
        <sql>alter table T_VOCABULARY_FOLDER ADD COLUMN FOLDER_ID INT(10) UNSIGNED NOT NULL default 1;
            alter table T_VOCABULARY_FOLDER ADD CONSTRAINT FK_FOLDER_ID FOREIGN KEY (FOLDER_ID)
                REFERENCES T_FOLDER (ID) ON UPDATE CASCADE ON DELETE CASCADE;
        </sql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-106">
        <comment>Update the correct FOLDER_ID values for T_VOCABULARY_FOLDER.</comment>
        <sql>
            update T_VOCABULARY_FOLDER, T_FOLDER set
            T_VOCABULARY_FOLDER.FOLDER_ID = T_FOLDER.ID
            where T_VOCABULARY_FOLDER.FOLDER_NAME = T_FOLDER.IDENTIFIER;
        </sql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-107">
        <comment>Fix vocabulary folder unique constraint.</comment>
        <sql>alter table T_VOCABULARY_FOLDER drop index UNIQUE_VOCABULARY;
            alter table T_VOCABULARY_FOLDER add unique index UNIQUE_VOCABULARY (FOLDER_ID, IDENTIFIER, WORKING_COPY);
            alter table T_VOCABULARY_FOLDER drop column FOLDER_NAME;
        </sql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-108">
        <comment>Create RDF namespace table.</comment>
        <sql>create table T_RDF_NAMESPACE (
                ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
                URI VARCHAR(255) NOT NULL,
                NAME_PREFIX VARCHAR(10) NOT NULL,
                PRIMARY KEY (ID)
            );
        </sql>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8" />
        </modifySql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-109">
        <comment>Fix RDF property related data.</comment>
        <sql>
            alter table M_ATTRIBUTE add column RDF_PROPERTY_NAMESPACE_ID INT(10) UNSIGNED;
            alter table M_ATTRIBUTE add column RDF_PROPERTY_NAME VARCHAR(255);
            alter table M_ATTRIBUTE ADD CONSTRAINT FK_RDF_PROPERTY_NAMESPACE_ID FOREIGN KEY (RDF_PROPERTY_NAMESPACE_ID)
                REFERENCES T_RDF_NAMESPACE (ID) ON UPDATE CASCADE ON DELETE CASCADE;
            insert into T_RDF_NAMESPACE (URI, NAME_PREFIX) values ("http://www.w3.org/2004/02/skos/core#", "skos");
            update M_ATTRIBUTE set RDF_PROPERTY_NAMESPACE_ID = 1, RDF_PROPERTY_NAME = substring(RDF_PROPERTY, locate(":", RDF_PROPERTY) + 1)
                where RDF_PROPERTY IS NOT NULL;
            alter table M_ATTRIBUTE drop column RDF_PROPERTY;
        </sql>
    </changeSet>

    <changeSet author="roug" id="rev-110">
        <comment>Expand the short name for dataset to match identifier in length</comment>
        <modifyDataType tableName="DATASET" columnName="SHORT_NAME" newDataType="VARCHAR(50)"/>
    </changeSet>

    <changeSet author="voolajuh" id="rev-111">
        <comment>Add sameAs vocabulary concept attribute.</comment>
        <sql>
            insert into T_RDF_NAMESPACE (URI, NAME_PREFIX) values ('http://www.w3.org/2002/07/owl#', 'owl');

            insert into M_ATTRIBUTE (NAME, DEFINITION, OBLIGATION, SHORT_NAME, DISP_TYPE, DISP_ORDER, DISP_WHEN, DISP_WIDTH, DISP_HEIGHT, DISP_MULTIPLE,
            DATA_TYPE, RDF_PROPERTY_NAME, RDF_PROPERTY_NAMESPACE_ID)
            values ('Same concept', 'Is used to state that two URI references refer to the same individual.', 'O', 'sameAsForeignConcept', 'text', 54, 512,
            60, 1, 1,'reference', 'sameAs', (select ID from T_RDF_NAMESPACE where NAME_PREFIX = 'owl'));
        </sql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-112">
        <comment>Add RDF type properties for DS_TABLE and DATAELEM tables.</comment>
        <sql>
            alter table DATAELEM add column RDF_TYPE_NAMESPACE_ID INT(10) UNSIGNED;
            alter table DATAELEM add column RDF_TYPE_NAME VARCHAR(255);
            alter table DATAELEM ADD CONSTRAINT FK_RDF_TYPE_NAMESPACE_ID FOREIGN KEY (RDF_TYPE_NAMESPACE_ID)
                            REFERENCES T_RDF_NAMESPACE (ID) ON UPDATE CASCADE ON DELETE CASCADE;

            alter table DS_TABLE add column RDF_TYPE_NAMESPACE_ID INT(10) UNSIGNED;
            alter table DS_TABLE add column RDF_TYPE_NAME VARCHAR(255);
            alter table DS_TABLE ADD CONSTRAINT FK_TABLE_RDF_TYPE_NAMESPACE_ID FOREIGN KEY (RDF_TYPE_NAMESPACE_ID)
                            REFERENCES T_RDF_NAMESPACE (ID) ON UPDATE CASCADE ON DELETE CASCADE;
        </sql>
    </changeSet>

    <changeSet author="voolajuh" id="rev-113">
        <comment>Add data element attributes for vocabulary concepts.</comment>
        <sql>
            create table T_VOCABULARY_ELEMENT (
                ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
                VOCABULARY_FOLDER_ID INT(10) UNSIGNED NOT NULL,
                DATAELEM_ID INT(10) UNSIGNED NOT NULL,
                PRIMARY KEY (ID)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
            ALTER TABLE T_VOCABULARY_ELEMENT ADD CONSTRAINT FK_ELEMENT_VOCABULARY_FOLDER_ID FOREIGN KEY (VOCABULARY_FOLDER_ID)
                    REFERENCES T_VOCABULARY_FOLDER (VOCABULARY_FOLDER_ID) ON UPDATE CASCADE ON DELETE CASCADE;
            ALTER TABLE T_VOCABULARY_ELEMENT ADD  CONSTRAINT FK_ELEMENT_DATAELEM_ID FOREIGN KEY (DATAELEM_ID)
                    REFERENCES DATAELEM (DATAELEM_ID) ON UPDATE CASCADE ON DELETE CASCADE;
            ALTER TABLE T_VOCABULARY_ELEMENT add constraint UNIQUE_VOCABULARY_ELEMENT unique (VOCABULARY_FOLDER_ID, DATAELEM_ID);

            create table T_CONCEPT_ELEMENT_VALUE  (
                ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
                VOCABULARY_CONCEPT_ID INT(10) UNSIGNED NOT NULL,
                DATAELEM_ID INT(10) UNSIGNED NOT NULL,
                ELEMENT_VALUE TEXT,
                PRIMARY KEY (ID)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
            ALTER TABLE T_CONCEPT_ELEMENT_VALUE ADD CONSTRAINT FK_VALUE_VOCABULARY_CONCEPT_ID FOREIGN KEY (VOCABULARY_CONCEPT_ID)
                    REFERENCES T_VOCABULARY_CONCEPT (VOCABULARY_CONCEPT_ID) ON UPDATE CASCADE ON DELETE CASCADE;
            ALTER TABLE T_CONCEPT_ELEMENT_VALUE ADD CONSTRAINT FK_VALUE_DATAELEM_ID FOREIGN KEY (DATAELEM_ID)
                    REFERENCES DATAELEM (DATAELEM_ID) ON UPDATE CASCADE ON DELETE CASCADE;
        </sql>
    </changeSet>

    <changeSet author="heinlja" id="rev-114">
        <comment>Add vocabulary folder column that indicates if concept notations in the vocabulary should always be forced as equal to concept identifiers.</comment>
        <addColumn tableName="T_VOCABULARY_FOLDER">
            <column name="NOTATIONS_EQUAL_IDENTIFIERS" type="tinyint(1)" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet author="lainekai" id="rev-115">
        <comment>Remove namespace ID and RDF type from dataelement and ds_table.</comment>
        <dropForeignKeyConstraint baseTableName="DATAELEM" constraintName="FK_RDF_TYPE_NAMESPACE_ID"/>
        <dropForeignKeyConstraint baseTableName="DS_TABLE" constraintName="FK_TABLE_RDF_TYPE_NAMESPACE_ID"/>
        <dropColumn tableName="DATAELEM" columnName="RDF_TYPE_NAMESPACE_ID"/>
        <dropColumn tableName="DATAELEM" columnName="RDF_TYPE_NAME"/>
        <dropColumn tableName="DS_TABLE" columnName="RDF_TYPE_NAMESPACE_ID"/>
        <dropColumn tableName="DS_TABLE" columnName="RDF_TYPE_NAME"/>
    </changeSet>

    <changeSet author="lainekai" id="rev-116">
        <comment>Add language and related element to vocabulary element values</comment>
        <addColumn tableName="T_CONCEPT_ELEMENT_VALUE">
            <column name="LANGUAGE" type="VARCHAR(10)" defaultValue="en"/>
        </addColumn>
        <addColumn tableName="T_CONCEPT_ELEMENT_VALUE">
            <column name="RELATED_CONCEPT_ID" type="INT UNSIGNED"/>
        </addColumn>
        <addColumn tableName="T_CONCEPT_ELEMENT_VALUE">
            <column name="LINK_TEXT" type="VARCHAR(255)"/>
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="RELATED_CONCEPT_ID" baseTableName="T_CONCEPT_ELEMENT_VALUE"
            constraintName="FK_ELEM_RELATED_CONCEPT_ID" deferrable="false" initiallyDeferred="false"
            onDelete="CASCADE" onUpdate="CASCADE"
            referencedColumnNames="VOCABULARY_CONCEPT_ID" referencedTableName="T_VOCABULARY_CONCEPT" referencesUniqueColumn="false"/>
     </changeSet>

    <changeSet author="lainekai" id="rev-117">
        <comment>Remove the table for concept attribute values that became obsolete</comment>
        <dropTable tableName="T_VOCABULARY_CONCEPT_ATTRIBUTE"/>
    </changeSet>

    <changeSet author="roug" id="rev-118">
        <comment>Rename the vocabulary tables to more sane names.
        Remove useless key column from M-M relation table. Remove unused tables.
        Rename the VOCABULARY_FOLDER_ID to VOCABULARY_ID</comment>
        <!-- MySQL won't let us change a column name that has constraints referencing it -->
        <dropForeignKeyConstraint baseTableName="T_VOCABULARY_CONCEPT" constraintName="FK_VOCABULARY_FOLDER_ID"/>
        <dropForeignKeyConstraint baseTableName="T_VOCABULARY_ELEMENT" constraintName="FK_ELEMENT_VOCABULARY_FOLDER_ID"/>
        <renameTable oldTableName="T_FOLDER" newTableName="VOCABULARY_SET"/>
        <renameTable oldTableName="T_VOCABULARY_FOLDER" newTableName="VOCABULARY"/>
        <renameTable oldTableName="T_VOCABULARY_CONCEPT" newTableName="VOCABULARY_CONCEPT"/>
        <renameTable oldTableName="T_VOCABULARY_ELEMENT" newTableName="VOCABULARY2ELEM"/>
        <renameTable oldTableName="T_CONCEPT_ELEMENT_VALUE" newTableName="VOCABULARY_CONCEPT_ELEMENT"/>
        <dropTable tableName="SCHEMA"/>
        <dropTable tableName="SCHEMA_SET"/>
        <dropColumn tableName="VOCABULARY2ELEM" columnName="ID"/>
        <renameColumn tableName="VOCABULARY" columnDataType="INT UNSIGNED NOT NULL AUTO_INCREMENT"
                oldColumnName="VOCABULARY_FOLDER_ID" newColumnName="VOCABULARY_ID"/>
        <renameColumn tableName="VOCABULARY2ELEM" columnDataType="INT UNSIGNED"
                oldColumnName="VOCABULARY_FOLDER_ID" newColumnName="VOCABULARY_ID"/>
        <renameColumn tableName="VOCABULARY_CONCEPT" columnDataType="INT UNSIGNED"
                oldColumnName="VOCABULARY_FOLDER_ID" newColumnName="VOCABULARY_ID"/>
        <!-- Recreate the constraints -->
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_ID" baseTableName="VOCABULARY_CONCEPT"
                constraintName="FK_VOCABULARY_ID"
                onDelete="CASCADE" onUpdate="CASCADE"
                referencedColumnNames="VOCABULARY_ID" referencedTableName="VOCABULARY"/>
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_ID" baseTableName="VOCABULARY2ELEM"
                constraintName="FK_ELEMENT_VOCABULARY_ID"
                onDelete="CASCADE" onUpdate="CASCADE"
                referencedColumnNames="VOCABULARY_ID" referencedTableName="VOCABULARY"/>
    </changeSet>

    <changeSet author="lainekai" id="rev-119">
        <comment>Drop default language from the bound element value as it is conceptually wrong</comment>
        <dropDefaultValue tableName="VOCABULARY_CONCEPT_ELEMENT" columnName="LANGUAGE"/>
    </changeSet>

    <changeSet author="lainekai" id="rev-120">
        <comment>index on PARENT TYPE and ELEMENT_ID</comment>
        <createIndex indexName="IDX_PARENT_TYPE_ID" tableName="ATTRIBUTE">
            <column name="PARENT_TYPE"/>
            <column name="DATAELEM_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="heinlja" id="rev-121">
        <comment>Remove IS_ROD_PARAM column from DATAELEM table, as it's no longer needed.</comment>
        <dropColumn tableName="DATAELEM" columnName="IS_ROD_PARAM"/>
    </changeSet>

    <changeSet author="roug" id="rev-122">
        <comment>Expand the label and notation for vocabulary concept to ensure the data will always fit</comment>
        <sql>ALTER TABLE VOCABULARY_CONCEPT CHANGE LABEL LABEL TEXT NOT NULL, CHANGE NOTATION NOTATION VARCHAR(100) DEFAULT NULL</sql>
    </changeSet>

    <changeSet author="heinlja" id="rev-123">
        <comment>Remove GIS column from DATAELEM table, as it's no longer needed.</comment>
        <dropColumn tableName="DATAELEM" columnName="GIS"/>
    </changeSet>

    <changeSet author="enverveli" id="rev-124">
        <comment>Change data type of DATE_DELETED to DATE</comment>
        <addColumn tableName="T_SITE_CODE">
            <column name="DATE_DELETED_TEMP" type="DATE" />
        </addColumn>
        <update tableName="T_SITE_CODE">
            <column name="DATE_DELETED_TEMP" valueComputed="STR_TO_DATE(CONCAT(DATE_DELETED, '-01-01'), '%Y-%m-%d')" type="DATE"/>
            <where>DATE_DELETED IS NOT NULL</where>
        </update>
        <dropColumn columnName="DATE_DELETED" tableName="T_SITE_CODE"/>
        <renameColumn newColumnName="DATE_DELETED" oldColumnName="DATE_DELETED_TEMP" tableName="T_SITE_CODE" columnDataType="DATE"/>
    </changeSet>

    <changeSet author="lainekai" id="rev-125">
        <comment>New type CH3 for fixed value elements related to a vocabulary.</comment>
        <modifyDataType tableName="DATAELEM" columnName="TYPE" newDataType="enum('CH1','CH2','CH3') NOT NULL default 'CH2'"/>
    </changeSet>

    <changeSet author="lainekai" id="rev-126">
        <comment>Add relation to vocabulary that can be used for Fixed values of the element. Boolean field to indicate if all concepts are legal or only
             the ones created before the element</comment>
        <addColumn tableName="DATAELEM">
            <column name="VOCABULARY_ID" type="INT UNSIGNED"></column>
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="VOCABULARY_ID" baseTableName="DATAELEM"
            constraintName="FK_ELEM_VOCABULARY_ID" deferrable="false" initiallyDeferred="false"
            onDelete="RESTRICT" onUpdate="CASCADE"
            referencedColumnNames="VOCABULARY_ID" referencedTableName="VOCABULARY" referencesUniqueColumn="false"/>
        <addColumn tableName="DATAELEM">
            <column name="ALL_CONCEPTS_LEGAL" type="TINYINT(1)" defaultValue="1"></column>
        </addColumn>
    </changeSet>

    <changeSet author="enverveli" id="rev-127">
        <comment>Drop Column SITE_CODE_ID from T_SITE_CODE table since it's redundant</comment>
        <sql>ALTER TABLE T_SITE_CODE MODIFY SITE_CODE_ID INT NOT NULL</sql>
        <dropPrimaryKey tableName="T_SITE_CODE"/>
        <dropColumn columnName="SITE_CODE_ID" tableName="T_SITE_CODE"/>
        <addPrimaryKey columnNames="VOCABULARY_CONCEPT_ID" tableName="T_SITE_CODE"/>
  </changeSet>

    <changeSet author="lainekai" id="rev-128">
        <comment>Add unique hashed key value to avoid duplicate concept element values</comment>
        <addColumn tableName="VOCABULARY_CONCEPT_ELEMENT">
            <column name="ATTR_MD5" type="VARCHAR(32)"  ></column>
        </addColumn>
        <addUniqueConstraint tableName="VOCABULARY_CONCEPT_ELEMENT" columnNames="ATTR_MD5" constraintName="UNIQ_ATTR_MD5"/>
    </changeSet>

    <changeSet author="lainekai" id="rev-129">
        <comment>Create triggers automatically creating key hashes on the VOCABULARY_CONCEPT_ELEMENT table</comment>
        <sql>
            CREATE TRIGGER ATTR_MD5_ON_INSERT
            BEFORE INSERT ON VOCABULARY_CONCEPT_ELEMENT
            FOR EACH ROW
            SET NEW.ATTR_MD5 = MD5(CONCAT(NEW.VOCABULARY_CONCEPT_ID, ',', NEW.DATAELEM_ID, ',',
            COALESCE(NEW.RELATED_CONCEPT_ID, NEW.ELEMENT_VALUE), '@', COALESCE(NEW.LANGUAGE, ''))
            );
            CREATE TRIGGER ATTR_MD5_ON_UPDATE
            BEFORE UPDATE ON VOCABULARY_CONCEPT_ELEMENT
            FOR EACH ROW
            SET NEW.ATTR_MD5 = MD5(
            CONCAT(NEW.VOCABULARY_CONCEPT_ID, ',', NEW.DATAELEM_ID, ',',
            COALESCE(NEW.RELATED_CONCEPT_ID, NEW.ELEMENT_VALUE), '@', COALESCE(NEW.LANGUAGE, '')
            )
            );
            UPDATE VOCABULARY_CONCEPT_ELEMENT SET DATAELEM_ID=DATAELEM_ID;
        </sql>
    </changeSet>
    <changeSet author="lainekai" id="rev-130">
        <comment>Create a table for inference rules</comment>
        <createTable tableName="INFERENCE_RULE">
            <column name="DATAELEM_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="RULE" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="TARGET_ELEM_ID" type="INT UNSIGNED">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="DATAELEM_ID" baseTableName="INFERENCE_RULE"
          constraintName="FK_DATAELEM_ID" deferrable="false" initiallyDeferred="false"
          onDelete="CASCADE" onUpdate="CASCADE"
          referencedColumnNames="DATAELEM_ID" referencedTableName="DATAELEM" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="TARGET_ELEM_ID" baseTableName="INFERENCE_RULE"
          constraintName="FK_TARGET_ELEM_ID" deferrable="false" initiallyDeferred="false"
          onDelete="CASCADE" onUpdate="CASCADE"
          referencedColumnNames="DATAELEM_ID" referencedTableName="DATAELEM" referencesUniqueColumn="false"/>
    </changeSet>
  <changeSet id="rev-131" author="lainekai" dbms="mysql">
    <comment>Change inference rule type to enum in Mysql only</comment>
    <sql>
      ALTER TABLE INFERENCE_RULE MODIFY RULE ENUM('owl:inverseOf');
    </sql>
  </changeSet>
  <changeSet id="rev-132" author="lainekai">
    <comment>Functions and procedure to create reverse links of referencial elements</comment>
    <sql endDelimiter="#">
      DROP FUNCTION IF EXISTS `GetInverseElemId`;
      #
      CREATE  FUNCTION `GetInverseElemId`(DataElementId int) RETURNS INT(11)
      BEGIN
          DECLARE InvereseElementId INT;
          SET InvereseElementId := (SELECT TARGET_ELEM_ID FROM INFERENCE_RULE WHERE DATAELEM_ID = DataElementId AND RULE = 'owl:inverseOf');

              -- not found try commutative
              IF InvereseElementId IS NULL THEN
                SET InvereseElementId := (SELECT DATAELEM_ID FROM INFERENCE_RULE WHERE TARGET_ELEM_ID = DataElementId AND RULE = 'owl:inverseOf');
              END IF;
          RETURN InvereseElementId;
      END
      #
      DROP PROCEDURE IF EXISTS `DeleteReverseLink`;
      #
      CREATE PROCEDURE `DeleteReverseLink`(DataElemId INT, ConceptId int)
      BEGIN
          DECLARE InverseElemId int;
          SET InverseElemID := GetInverseElemId(DataElemId);

          IF InverseElemID IS NOT NULL THEN
              delete from VOCABULARY_CONCEPT_ELEMENT WHERE DATAELEM_ID = InverseElemId AND RELATED_CONCEPT_ID = ConceptId;
          END IF;
      END
      #
      DROP PROCEDURE IF EXISTS `CreateReverseLink`;
      #
      CREATE PROCEDURE `CreateReverseLink`(DataElemId INT, ConceptId INT, TargetConceptId INT)
      BEGIN
          DECLARE InverseElemId int;
          DECLARE TargetVocabularyId int;
          DECLARE TargetCheckedOutVocabularyId int;
          DECLARE TargetCheckedOutConceptId int;

          SET InverseElemID := GetInverseElemId(DataElemId);

          IF InverseElemID IS NOT NULL THEN

          SET TargetVocabularyId := (SELECT VOCABULARY_ID FROM VOCABULARY_CONCEPT WHERE VOCABULARY_CONCEPT_ID = TargetConceptId);

               -- manipulate also checked out copy if such exists
               SET TargetCheckedOutVocabularyId := (SELECT VOCABULARY_ID FROM VOCABULARY WHERE CHECKEDOUT_COPY_ID = TargetVocabularyId);

               -- bind target element to the vocabulary if not bound yet
               insert ignore into VOCABULARY2ELEM (VOCABULARY_ID, DATAELEM_ID) values (TargetVocabularyId, InverseElemId);

                    -- add the value of this concept to target concept:
                    insert ignore into VOCABULARY_CONCEPT_ELEMENT (VOCABULARY_CONCEPT_ID, DATAELEM_ID, RELATED_CONCEPT_ID) VALUES (TargetConceptId, InverseElemId, ConceptId);

              -- if checkedout create relations also in checkedout copy
              IF TargetCheckedOutVocabularyId IS NOT NULL THEN
                  SET TargetCheckedOutConceptId = (SELECT VOCABULARY_CONCEPT_ID FROM VOCABULARY_CONCEPT WHERE ORIGINAL_CONCEPT_ID = TargetConceptId);
                  IF TargetCheckedOutConceptId is not null then
                      insert ignore into VOCABULARY2ELEM (VOCABULARY_ID, DATAELEM_ID) values (TargetCheckedOutVocabularyId, InverseElemId);
                      insert ignore into VOCABULARY_CONCEPT_ELEMENT (VOCABULARY_CONCEPT_ID, DATAELEM_ID, RELATED_CONCEPT_ID) VALUES (TargetCheckedOutConceptId, InverseElemId, ConceptId);
                  END IF;
              END IF; -- checked out
                END IF; -- inverse rule exists
            END
    </sql>
  </changeSet>
  <changeSet id="rev-133" author="lainekai" runOnChange="true">
   <sql endDelimiter="#">
        <![CDATA[
        DROP PROCEDURE IF EXISTS `PrintLog`;
        #
        -- helper procedure to debug status in mysql prompt
        CREATE PROCEDURE `PrintLog`(str VARCHAR(255))
        BEGIN
            SELECT concat('[', DATE_FORMAT(NOW(), '%h:%m:%s - %d.%m.%Y'), '] - ', str) AS info FROM dual;
        END
        #
        DROP PROCEDURE IF EXISTS `CreateMissingInverseElements`;
        #
        CREATE PROCEDURE `CreateMissingInverseElements`()
            BEGIN
          DECLARE tStartTime TIMESTAMP;
          DECLARE tEndTime TIMESTAMP;

                DECLARE intConceptID INT(20);
                DECLARE intRelatedConceptID INT(20);
                DECLARE intDataElemID INT(20);

                DECLARE done INT DEFAULT FALSE;

          -- declare cursor for missing inverse relations
          -- only checked in copies
          DECLARE cur CURSOR FOR
          SELECT ve_source.VOCABULARY_CONCEPT_ID, ve_source.DATAELEM_ID, ve_source.RELATED_CONCEPT_ID
          from VOCABULARY_CONCEPT_ELEMENT ve_source, INFERENCE_RULE ir1, VOCABULARY_CONCEPT vc, VOCABULARY v
              where
              ve_source.VOCABULARY_CONCEPT_ID = vc.VOCABULARY_CONCEPT_ID and vc.VOCABULARY_ID = v.VOCABULARY_ID and
                  v.WORKING_COPY = 0 AND
              ve_source.DATAELEM_ID = ir1.DATAELEM_ID
              and ve_source.RELATED_CONCEPT_ID is not null and ve_source.RELATED_CONCEPT_ID <> 0
              AND NOT EXISTS (
              SELECT 1 FROM VOCABULARY_CONCEPT_ELEMENT ve_target WHERE
              ve_target.DATAELEM_ID = ir1.TARGET_ELEM_ID AND ve_target.RELATED_CONCEPT_ID = ve_source.VOCABULARY_CONCEPT_ID)
          union SELECT ve_source.VOCABULARY_CONCEPT_ID, ve_source.DATAELEM_ID, ve_source.RELATED_CONCEPT_ID
          from VOCABULARY_CONCEPT_ELEMENT ve_source, INFERENCE_RULE ir1 , VOCABULARY_CONCEPT vc, VOCABULARY v
              where
              ve_source.VOCABULARY_CONCEPT_ID = vc.VOCABULARY_CONCEPT_ID and vc.VOCABULARY_ID = v.VOCABULARY_ID and
                  v.WORKING_COPY = 0 AND
              ve_source.DATAELEM_ID = ir1.TARGET_ELEM_ID
              and ve_source.RELATED_CONCEPT_ID is not null and ve_source.RELATED_CONCEPT_ID != 0
              AND NOT EXISTS (
              SELECT 1 FROM VOCABULARY_CONCEPT_ELEMENT ve_target WHERE
              ve_target.DATAELEM_ID = ir1.DATAELEM_ID AND ve_target.RELATED_CONCEPT_ID = ve_source.VOCABULARY_CONCEPT_ID)
          ;

          -- declare handle
          DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;

          set tStartTime := current_timestamp;
          -- open cursor
          OPEN cur;

          -- starts the loop
          the_loop: LOOP

          -- get the values of each column into our variables
              FETCH cur INTO intConceptID, intDataElemID, intRelatedConceptID;
              IF done THEN
                  LEAVE the_loop;
              END IF;

              call PrintLog(concat('Creating reverse reference for Concept ID=', intConceptID, ' DataElem ID=', intDataElemID, ' Related Concept ID=', intRelatedConceptID));
              call CreateReverseLink(intDataElemID, intConceptID, intRelatedConceptID);
          END LOOP the_loop;

          CLOSE cur;
          set tEndTime := current_timestamp;
                call PrintLog(concat('Total duration: ', TIME_TO_SEC(timediff(tEndTime, tStartTime)), 's') );
            END ;
        ]]>
    </sql>
  </changeSet>
   <changeSet author="enverveli" id="rev-134">
      <comment>Add not-null constraint for BASE_URI column in VOCABULARY table.</comment>
      <addNotNullConstraint tableName="VOCABULARY" columnName="BASE_URI" columnDataType="VARCHAR(255)"/>
   </changeSet>

   <changeSet author="enverveli" id="rev-135">
      <comment>New type Deprecated for released status of schema set.</comment>
      <modifyDataType tableName="T_SCHEMA_SET" columnName="REG_STATUS" newDataType="enum('Draft','Public draft','Released','Deprecated') default 'Draft'"/>
    </changeSet>

    <changeSet author="enverveli" id="rev-136">
        <comment>Add status modified column to schema table to track changes on reg_status column.</comment>
        <addColumn tableName="T_SCHEMA_SET">
            <column name="STATUS_MODIFIED" type="DATETIME"/>
        </addColumn>
        <update tableName="T_SCHEMA_SET">
            <column name="STATUS_MODIFIED" valueComputed="TIMESTAMP(DATE_MODIFIED)"/>
            <where>DATE_MODIFIED IS NOT NULL</where>
        </update>
    </changeSet>

    <changeSet author="roug" id="rev-137">
        <comment>Identifiers are case sensitive</comment>
        <modifyDataType tableName="VOCABULARY_CONCEPT" columnName="IDENTIFIER"
            newDataType="VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL"/>
    </changeSet>

  <changeSet author="enverveli" id="rev-138">
      <comment>Updates to introduce more status types for vocabulary concept. Includes followings:
          --> Add new column STATUS (enum) and update all obsolete concepts to invalid.
          --> Add new column STATUS_MODIFIED
          --> Add new column ACCEPTED_DATE and populate with CREATION_DATE
          --> Add new column NOT_ACCEPTED_DATE and populate with OBSOLETE_DATE
          --> Remove CREATION_DATE and OBSOLETE_DATE columns
      </comment>
      <addColumn tableName="VOCABULARY_CONCEPT">
          <column name="STATUS" defaultValueNumeric="145" type="TINYINT UNSIGNED"
                  remarks="Enum Values are as follows:
                  NOT_ACCEPTED('Not accepted', 64),
                  SUBMITTED('Submitted', 81),
                  RESERVED('Reserved', 97),
                  INVALID('Invalid', 113),
                  ACCEPTED('Accepted', 128),
                  VALID('Valid', 145),
                  VALID_STABLE('Valid - stable', 147),
                  VALID_EXPERIMENTAL('Valid - experimental', 149),
                  DEPRECATED('Deprecated', 161),
                  DEPRECATED_RETIRED('Deprecated - retired', 163),
                  DEPRECATED_SUPERSEDED('Deprecated - superseded', 165).
                  Default value = 145 = VALID.">
              <constraints nullable="false"/>
          </column>
          <column name="STATUS_MODIFIED" defaultValue="NULL" type="DATETIME"/>
          <column name="ACCEPTED_DATE" defaultValue="NULL" type="DATETIME"/>
          <column name="NOT_ACCEPTED_DATE" defaultValue="NULL" type="DATETIME"/>
      </addColumn>
      <update tableName="VOCABULARY_CONCEPT">
          <column name="STATUS" valueNumeric="113"/>
          <where>OBSOLETE_DATE IS NOT NULL</where>
      </update>
      <update tableName="VOCABULARY_CONCEPT">
          <column name="NOT_ACCEPTED_DATE" valueComputed="TIMESTAMP(OBSOLETE_DATE)"/>
          <where>OBSOLETE_DATE IS NOT NULL</where>
      </update>
      <update tableName="VOCABULARY_CONCEPT">
          <column name="ACCEPTED_DATE" valueComputed="TIMESTAMP(CREATION_DATE)"/>
          <where>CREATION_DATE IS NOT NULL</where>
      </update>
      <update tableName="VOCABULARY_CONCEPT">
          <column name="STATUS_MODIFIED" valueComputed="TIMESTAMP(CREATION_DATE)"/>
          <where>OBSOLETE_DATE IS NULL</where>
      </update>
      <update tableName="VOCABULARY_CONCEPT">
          <column name="STATUS_MODIFIED" valueComputed="TIMESTAMP(OBSOLETE_DATE)"/>
          <where>OBSOLETE_DATE IS NOT NULL</where>
      </update>
      <dropColumn tableName="VOCABULARY_CONCEPT" columnName="OBSOLETE_DATE"/>
      <dropColumn tableName="VOCABULARY_CONCEPT" columnName="CREATION_DATE"/>
  </changeSet>

  <changeSet author="nakasnik" id="rev-139">
      <comment>
          Calculates the actual modification date of the schema-set with the given id,
          based both on the date_modified field of the schema-set, as well as its child
          schemas.
      </comment>
      <sql>drop function if exists func_getSchemaSetModificationDate</sql>
      <createProcedure>
        <![CDATA[
            create function func_getSchemaSetModificationDate (schema_set_id int)
            returns timestamp
            begin
                declare date_modified timestamp;

                select 
                    max(dates.DATE_MODIFIED) into date_modified
                from 
                    (
                        select
                            case when ss.DATE_MODIFIED > s.DATE_MODIFIED then 
                                ss.DATE_MODIFIED 
                            else 
                                s.DATE_MODIFIED 
                            end as DATE_MODIFIED
                        from  
                            (
                                select 
                                    tss.* 
                                from 
                                    T_SCHEMA_SET tss 
                                where 
                                    tss.SCHEMA_SET_ID = schema_set_id
                            ) ss 
                                inner join 
                            T_SCHEMA s 
                                on ss.SCHEMA_SET_ID = s.SCHEMA_SET_ID
                    ) dates;

                return date_modified;
            end
        ]]>
      </createProcedure>
      <rollback>
          <sql>drop function if exists func_getSchemaSetModificationDate</sql>
      </rollback>
  </changeSet>

  <changeSet author="nakasnik" id="rev-140">
      <comment>
          Revert rev-139 whose logic turned out to be unnecessary.
      </comment>
      <sql>drop function if exists func_getSchemaSetModificationDate</sql>
  </changeSet>

  <changeSet author="nakasnik" id="rev-141" dbms="mysql">
      <sql>
          alter table INFERENCE_RULE ENGINE = InnoDB;
      </sql>
  </changeSet>

  <changeSet author="nakasnik" id="rev-142" dbms="mysql">
      <sql>
          alter table INFERENCE_RULE convert to character set utf8 collate utf8_unicode_ci;
      </sql>
  </changeSet>

  <changeSet author="enverveli" id="rev-143">
      <comment>Create a table to store API keys to be used authentication for external end points.
          Table will have following fields:
          - IDENTIFIER: a unique identifier for the api key
          - SCOPE: a free format scope field (e.g. vocabulary, dataelements)
          - KEY_VALUE: a value for api key (expected to be unique)
          - REMOTE_ADDR: remote host address or ip address (if applicable)
          - EXPIRES: API expiration date (if applicable)
          - NOTES: notes for admin
      </comment>
      <createTable tableName="API_KEY">
          <column name="IDENTIFIER" type="VARCHAR(100)">
              <constraints nullable="false" unique="true"/>
          </column>
          <column name="SCOPE" type="VARCHAR(100)"/>
          <column name="KEY_VALUE" type="VARCHAR(255)">
              <constraints nullable="false" unique="true"/>
          </column>
          <column name="REMOTE_ADDR" type="VARCHAR(255)"/>
          <column name="EXPIRES" type="DATETIME"/>
          <column name="NOTES" type="VARCHAR(255)"/>
      </createTable>
      <modifySql dbms="mysql">
          <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
      </modifySql>
  </changeSet>

    <changeSet author="nakasnik" id="rev-144">
        <createIndex indexName="IDX_M_ATTRIBUTE_NAME" tableName="M_ATTRIBUTE" unique="false">
            <column name="NAME"/>
        </createIndex>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-145">
        <addForeignKeyConstraint baseColumnNames="DATAELEM_ID" baseTableName="INFERENCE_RULE"
          constraintName="FK_DATAELEMENT_ID" deferrable="false" initiallyDeferred="false"
          onDelete="CASCADE" onUpdate="CASCADE"
          referencedColumnNames="DATAELEM_ID" referencedTableName="DATAELEM" referencesUniqueColumn="false"/>
        <addForeignKeyConstraint baseColumnNames="TARGET_ELEM_ID" baseTableName="INFERENCE_RULE"
          constraintName="FK_TARGET_ELEMENT_ID" deferrable="false" initiallyDeferred="false"
          onDelete="CASCADE" onUpdate="CASCADE"
          referencedColumnNames="DATAELEM_ID" referencedTableName="DATAELEM" referencesUniqueColumn="false"/>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-146">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="INFERENCE_RULE" foreignKeyName="FK_DATAELEMENT_ID"/>
        </preConditions>
        <comment>
            Revert rev-145. Drop foreign key "FK_DATAELEMENT_ID"
        </comment>
        <dropForeignKeyConstraint baseTableName="INFERENCE_RULE" constraintName="FK_DATAELEMENT_ID"/>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-147">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="INFERENCE_RULE" foreignKeyName="FK_TARGET_ELEMENT_ID"/>
        </preConditions>
        <comment>
            Revert rev-145. Drop foreign key "FK_TARGET_ELEMENT_ID"
        </comment>
        <dropForeignKeyConstraint baseTableName="INFERENCE_RULE" constraintName="FK_TARGET_ELEMENT_ID"/>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-148">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="INFERENCE_RULE" foreignKeyName="FK_DATAELEM_ID"/>
            </not>
        </preConditions>
        <comment>
            Create foreign key constraint FK_DATAELEM_ID for INFERENECE_RULE. 
        </comment>
        <addForeignKeyConstraint  baseColumnNames="DATAELEM_ID" baseTableName="INFERENCE_RULE"
          constraintName="FK_DATAELEM_ID" deferrable="false" initiallyDeferred="false"
          onDelete="CASCADE" onUpdate="CASCADE"
          referencedColumnNames="DATAELEM_ID" referencedTableName="DATAELEM" referencesUniqueColumn="false"/>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-149">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="INFERENCE_RULE" foreignKeyName="FK_TARGET_ELEM_ID"/>
            </not>
        </preConditions>
        <comment>
            Create foreign key constraint FK_TARGET_ELEM_ID for INFERENECE_RULE.
        </comment>
        <addForeignKeyConstraint baseColumnNames="TARGET_ELEM_ID" baseTableName="INFERENCE_RULE"
          constraintName="FK_TARGET_ELEM_ID" deferrable="false" initiallyDeferred="false"
          onDelete="CASCADE" onUpdate="CASCADE"
          referencedColumnNames="DATAELEM_ID" referencedTableName="DATAELEM" referencesUniqueColumn="false"/>
    </changeSet>
    
    <changeSet id="rev-150" author="nakasnik">
        <createTable tableName="QRTZ_JOB_DETAILS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_JOB_DETAILS" />
            </column>
            <column name="JOB_NAME" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_JOB_DETAILS" />
            </column>
            <column name="JOB_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_JOB_DETAILS" />
            </column>
            <column name="DESCRIPTION" type="VARCHAR(250)">
                <constraints nullable="true" />
            </column>
            <column name="JOB_CLASS_NAME" type="VARCHAR(250)">
                <constraints nullable="false" />
            </column>
            <column name="IS_DURABLE" type="VARCHAR(1)">
                <constraints nullable="false" />
            </column>
            <column name="IS_NONCONCURRENT" type="VARCHAR(1)">
                <constraints nullable="false" />
            </column>
            <column name="IS_UPDATE_DATA" type="VARCHAR(1)">
                <constraints nullable="false" />
            </column>
            <column name="REQUESTS_RECOVERY" type="VARCHAR(1)">
                <constraints nullable="false" />
            </column>
            <column name="JOB_DATA" type="BLOB">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
       </modifySql>
    </changeSet>
    
    <changeSet id="rev-151" author="nakasnik">
        <createTable tableName="QRTZ_TRIGGERS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_TRIGGERS" />
            </column>
            <column name="TRIGGER_NAME" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_TRIGGERS" />
            </column>
            <column name="TRIGGER_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_TRIGGERS" />
            </column>
            <column name="JOB_NAME" type="VARCHAR(200)">
                <constraints nullable="false" />
            </column>
            <column name="JOB_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" />
            </column>
            <column name="DESCRIPTION" type="VARCHAR(250)">
                <constraints nullable="true" />
            </column>
            <column name="NEXT_FIRE_TIME" type="BIGINT(13)">
                <constraints nullable="true" />
            </column>
            <column name="PREV_FIRE_TIME" type="BIGINT(13)">
                <constraints nullable="true" />
            </column>
            <column name="PRIORITY" type="INTEGER">
                <constraints nullable="true" />
            </column>
            <column name="TRIGGER_STATE" type="VARCHAR(16)">
                <constraints nullable="false" />
            </column>
            <column name="TRIGGER_TYPE" type="VARCHAR(8)">
                <constraints nullable="false" />
            </column>
            <column name="START_TIME" type="BIGINT(13))">
                <constraints nullable="false" />
            </column>
            <column name="END_TIME" type="BIGINT(13)">
                <constraints nullable="true" />
            </column>
            <column name="CALENDAR_NAME" type="VARCHAR(250)">
                <constraints nullable="true" />
            </column>
            <column name="MISFIRE_INSTR" type="SMALLINT(2)">
                <constraints nullable="true" />
            </column>
            <column name="JOB_DATA" type="BLOB">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-152" author="nakasnik">
        <addForeignKeyConstraint 
            constraintName="QRTZ_TRIGGERS_ibfk_1" 
            baseTableName="QRTZ_TRIGGERS" baseColumnNames="SCHED_NAME, JOB_NAME, JOB_GROUP"  
            referencedTableName="QRTZ_JOB_DETAILS" referencedColumnNames="SCHED_NAME, JOB_NAME, JOB_GROUP" />
    </changeSet>
    
    <changeSet id="rev-153" author="nakasnik">
        <createTable tableName="QRTZ_SIMPLE_TRIGGERS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_SIMPLE_TRIGGERS" />
            </column>
            <column name="TRIGGER_NAME" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_SIMPLE_TRIGGERS" />
            </column>
            <column name="TRIGGER_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_SIMPLE_TRIGGERS" />
            </column>
            <column name="REPEAT_COUNT" type="BIGINT(7)">
                <constraints nullable="false" />
            </column>
            <column name="REPEAT_INTERVAL" type="BIGINT(12)">
                <constraints nullable="false" />
            </column>
            <column name="TIMES_TRIGGERED" type="BIGINT(13)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-154" author="nakasnik">
        <addForeignKeyConstraint 
            constraintName="QRTZ_SIMPLE_TRIGGERS_ibfk_1" 
            baseTableName="QRTZ_SIMPLE_TRIGGERS" baseColumnNames="SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP"  
            referencedTableName="QRTZ_TRIGGERS" referencedColumnNames="SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP" />
    </changeSet>
    
    <changeSet id="rev-155" author="nakasnik">
        <createTable tableName="QRTZ_CRON_TRIGGERS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_CRON_TRIGGERS" />
            </column>
            <column name="TRIGGER_NAME" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_CRON_TRIGGERS" />
            </column>
            <column name="TRIGGER_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_CRON_TRIGGERS" />
            </column>
            <column name="CRON_EXPRESSION" type="VARCHAR(200)">
                <constraints nullable="false" />
            </column>
            <column name="TIME_ZONE_ID" type="VARCHAR(80)">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-156" author="nakasnik">
        <addForeignKeyConstraint 
            constraintName="QRTZ_CRON_TRIGGERS_ibfk_1" 
            baseTableName="QRTZ_CRON_TRIGGERS" baseColumnNames="SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP"  
            referencedTableName="QRTZ_TRIGGERS" referencedColumnNames="SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP" />
    </changeSet>
    
    <changeSet id="rev-157" author="nakasnik">
        <createTable tableName="QRTZ_SIMPROP_TRIGGERS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_SIMPROP_TRIGGERS" />
            </column>
            <column name="TRIGGER_NAME" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_SIMPROP_TRIGGERS" />
            </column>
            <column name="TRIGGER_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_SIMPROP_TRIGGERS" />
            </column>
            <column name="STR_PROP_1" type="VARCHAR(512)">
                <constraints nullable="true" />
            </column>
            <column name="STR_PROP_2" type="VARCHAR(512)">
                <constraints nullable="true" />
            </column>
            <column name="STR_PROP_3" type="VARCHAR(512)">
                <constraints nullable="true" />
            </column>
            <column name="INT_PROP_1" type="INT">
                <constraints nullable="true" />
            </column>
            <column name="INT_PROP_2" type="INT">
                <constraints nullable="true" />
            </column>
            <column name="LONG_PROP_1" type="BIGINT">
                <constraints nullable="true" />
            </column>
            <column name="LONG_PROP_2" type="BIGINT">
                <constraints nullable="true" />
            </column>
            <column name="DEC_PROP_1" type="NUMERIC(13,4)">
                <constraints nullable="true" />
            </column>
            <column name="DEC_PROP_2" type="NUMERIC(13,4)">
                <constraints nullable="true" />
            </column>
            <column name="BOOL_PROP_1" type="VARCHAR(1)">
                <constraints nullable="true" />
            </column>
            <column name="BOOL_PROP_2" type="VARCHAR(1)">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-158" author="nakasnik">
        <addForeignKeyConstraint 
            constraintName="QRTZ_SIMPROP_TRIGGERS_ibfk_1" 
            baseTableName="QRTZ_SIMPROP_TRIGGERS" baseColumnNames="SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP"  
            referencedTableName="QRTZ_TRIGGERS" referencedColumnNames="SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP" />
    </changeSet>
    
    <changeSet id="rev-159" author="nakasnik">
        <createTable tableName="QRTZ_BLOB_TRIGGERS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_BLOB_TRIGGERS" />
            </column>
            <column name="TRIGGER_NAME" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_BLOB_TRIGGERS" />
            </column>
            <column name="TRIGGER_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_BLOB_TRIGGERS" />
            </column>
            <column name="BLOB_DATA" type="BLOB">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-160" author="nakasnik">
        <addForeignKeyConstraint 
            constraintName="QRTZ_BLOB_TRIGGERS_ibfk_1" 
            baseTableName="QRTZ_BLOB_TRIGGERS" baseColumnNames="SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP"  
            referencedTableName="QRTZ_TRIGGERS" referencedColumnNames="SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP" />
    </changeSet>
    
    <changeSet id="rev-161" author="nakasnik">
        <createTable tableName="QRTZ_CALENDARS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_CALENDARS" />
            </column>
            <column name="CALENDAR_NAME" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_CALENDARS" />
            </column>
            <column name="CALENDAR" type="BLOB">
                <constraints nullable="false" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-162" author="nakasnik">
        <createTable tableName="QRTZ_PAUSED_TRIGGER_GRPS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_PAUSED_TRIGGER_GRPS" />
            </column>
            <column name="TRIGGER_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_PAUSED_TRIGGER_GRPS" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-163" author="nakasnik">
        <createTable tableName="QRTZ_FIRED_TRIGGERS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_FIRED_TRIGGERS" />
            </column>
            <column name="ENTRY_ID" type="VARCHAR(95)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_FIRED_TRIGGERS" />
            </column>
            <column name="TRIGGER_NAME" type="VARCHAR(200)">
                <constraints nullable="false" />
            </column>
            <column name="TRIGGER_GROUP" type="VARCHAR(200)">
                <constraints nullable="false" />
            </column>
            <column name="INSTANCE_NAME" type="VARCHAR(200)">
                <constraints nullable="false" />
            </column>
            <column name="FIRED_TIME" type="BIGINT(13)">
                <constraints nullable="false" />
            </column>
            <column name="SCHED_TIME" type="BIGINT(13)">
                <constraints nullable="false" />
            </column>
            <column name="PRIORITY" type="INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="STATE" type="VARCHAR(16)">
                <constraints nullable="false" />
            </column>
            <column name="JOB_NAME" type="VARCHAR(200)">
                <constraints nullable="true" />
            </column>
            <column name="JOB_GROUP" type="VARCHAR(200)">
                <constraints nullable="true" />
            </column>
            <column name="IS_NONCONCURRENT" type="VARCHAR(1)">
                <constraints nullable="true" />
            </column>
            <column name="REQUESTS_RECOVERY" type="VARCHAR(1)">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-164" author="nakasnik">
        <createTable tableName="QRTZ_SCHEDULER_STATE">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_SCHEDULER_STATE" />
            </column>
            <column name="INSTANCE_NAME" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_SCHEDULER_STATE" />
            </column>
            <column name="LAST_CHECKIN_TIME" type="BIGINT(13)">
                <constraints nullable="false" />
            </column>
            <column name="CHECKIN_INTERVAL" type="BIGINT(13)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-165" author="nakasnik">
        <createTable tableName="QRTZ_LOCKS">
            <column name="SCHED_NAME" type="VARCHAR(120)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_LOCKS" />
            </column>
            <column name="LOCK_NAME" type="VARCHAR(40)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_QRTZ_LOCKS" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet id="rev-166" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_J_REQ_RECOVERY" tableName="QRTZ_JOB_DETAILS" >
            <column name="SCHED_NAME" />
            <column name="REQUESTS_RECOVERY" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-167" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_J_GRP" tableName="QRTZ_JOB_DETAILS" >
            <column name="SCHED_NAME" />
            <column name="JOB_GROUP" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-168" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_J" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="JOB_NAME" />
            <column name="JOB_GROUP" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-169" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_JG" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="JOB_GROUP" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-170" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_C" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="CALENDAR_NAME" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-171" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_G" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="TRIGGER_GROUP" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-172" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_STATE" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="TRIGGER_STATE" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-173" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_N_STATE" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="TRIGGER_NAME" />
            <column name="TRIGGER_GROUP" />
            <column name="TRIGGER_STATE" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-174" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_N_G_STATE" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="TRIGGER_GROUP" />
            <column name="TRIGGER_STATE" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-175" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_NEXT_FIRE_TIME" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="NEXT_FIRE_TIME" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-176" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_NFT_ST" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="TRIGGER_STATE" />
            <column name="NEXT_FIRE_TIME" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-177" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_NFT_MISFIRE" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="MISFIRE_INSTR" />
            <column name="NEXT_FIRE_TIME" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-178" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_NFT_ST_MISFIRE" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="MISFIRE_INSTR" />
            <column name="NEXT_FIRE_TIME" />
            <column name="TRIGGER_STATE" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-179" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_T_NFT_ST_MISFIRE_GRP" tableName="QRTZ_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="MISFIRE_INSTR" />
            <column name="NEXT_FIRE_TIME" />
            <column name="TRIGGER_GROUP" />
            <column name="TRIGGER_STATE" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-180" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_FT_TRIG_INST_NAME" tableName="QRTZ_FIRED_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="INSTANCE_NAME" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-181" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_FT_INST_JOB_REQ_RCVRY" tableName="QRTZ_FIRED_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="INSTANCE_NAME" />
            <column name="REQUESTS_RECOVERY" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-182" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_FT_J_G" tableName="QRTZ_FIRED_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="JOB_NAME" />
            <column name="JOB_GROUP" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-183" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_FT_JG" tableName="QRTZ_FIRED_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="JOB_GROUP" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-184" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_FT_T_G" tableName="QRTZ_FIRED_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="TRIGGER_NAME" />
            <column name="TRIGGER_GROUP" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-185" author="nakasnik">
        <createIndex indexName="IDX_QRTZ_FT_TG" tableName="QRTZ_FIRED_TRIGGERS" >
            <column name="SCHED_NAME" />
            <column name="TRIGGER_GROUP" />
        </createIndex>
    </changeSet>
    
    <changeSet id="rev-186" author="nakasnik">
        <createTable tableName="ASYNC_TASK_ENTRY">
            <column name="TASK_ID" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_ASYNC_TASK_ENTRY" />
            </column>
            <column name="TASK_CLASS_NAME" type="VARCHAR(250)">
                <constraints nullable="false" />
            </column>
            <column name="EXECUTION_STATUS" type="TINYINT">
                <constraints nullable="false" />
            </column>
            <column name="SCHEDULED_DATE" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="START_DATE" type="BIGINT">
                <constraints nullable="true" />
            </column>
            <column name="END_DATE" type="BIGINT">
                <constraints nullable="true" />
            </column>
            <column name="SERIALIZED_PARAMETERS" type="TEXT">
                <constraints nullable="true" />
            </column>
            <column name="SERIALIZED_RESULT" type="TEXT">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-187">
        <comment>
            Add display type vocabulary for attributes linked to vocabularies
        </comment>
        <modifyDataType tableName="M_ATTRIBUTE" 
                        columnName="DISP_TYPE" 
                        newDataType="enum('text','textarea','select','image','vocabulary')"/>
        <addDefaultValue tableName="M_ATTRIBUTE" columnName="DISP_TYPE" defaultValue="text"/>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-188">
        <comment>
            Add a table used for linking attribute definitions to vocabularies
        </comment>
        <createTable tableName="M_ATTRIBUTE_VOCABULARY">
            <column name="M_ATTRIBUTE_ID" type="INT UNSIGNED"/>
            <column name="VOCABULARY_ID" type="INT UNSIGNED"/> 
        </createTable>
        <addPrimaryKey tableName="M_ATTRIBUTE_VOCABULARY" columnNames="M_ATTRIBUTE_ID"/>
        <addForeignKeyConstraint baseTableName="M_ATTRIBUTE_VOCABULARY"
                                 baseColumnNames="M_ATTRIBUTE_ID" constraintName="FK_M_ATTRIBUTE" 
                                 referencedTableName="M_ATTRIBUTE" referencedColumnNames="M_ATTRIBUTE_ID"/>
        <addForeignKeyConstraint baseTableName="M_ATTRIBUTE_VOCABULARY" 
                                 baseColumnNames="VOCABULARY_ID" constraintName="FK_VOCABULARY" 
                                 referencedTableName="VOCABULARY" referencedColumnNames="VOCABULARY_ID"/>
    </changeSet>
    
     <changeSet author="kopanalk" id="rev-189">
        <comment>
            Add two Registration Statuses in the DATASET table (By altering the REG_STATUS data type). Refs #29879.
        </comment>
        <modifyDataType
            tableName="DATASET"
            columnName="REG_STATUS"
            newDataType="enum('Recorded','Qualified','Released','Incomplete','Candidate','Retired','Superseded')"/>
        <addNotNullConstraint tableName="DATASET" columnName="REG_STATUS" columnDataType="enum('Recorded','Qualified','Released','Incomplete','Candidate','Retired','Superseded')"/>
        <addDefaultValue tableName="DATASET" columnName="REG_STATUS" defaultValue="Incomplete"/>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-190">
       <comment>
            Add two Registration Statuses in the DATAELEM table (By altering the REG_STATUS data type). Refs #29879.
        </comment>
        <modifyDataType
            tableName="DATAELEM"
            columnName="REG_STATUS"
            newDataType="enum('Recorded','Qualified','Released','Incomplete','Candidate','Retired','Superseded')"/>
        <addNotNullConstraint tableName="DATAELEM" columnName="REG_STATUS" columnDataType="enum('Recorded','Qualified','Released','Incomplete','Candidate','Retired','Superseded')"/>
        <addDefaultValue tableName="DATAELEM" columnName="REG_STATUS" defaultValue="Incomplete"/>
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-191">
        <comment>
            Add a column in the DATAELEM table in order to link the superseded data elements to their successors (if this is the case). Refs #29879.
        </comment>
        <addColumn tableName="DATAELEM">
            <column name="SUCCESSOR" type="INT UNSIGNED"/>
        </addColumn>
        <addForeignKeyConstraint constraintName="FK_SUPERSEDED_SUCCESSOR_DE" baseTableName="DATAELEM" baseColumnNames="SUCCESSOR" referencedColumnNames="DATAELEM_ID"  referencedTableName="DATAELEM"/> 
    </changeSet>
    
    <changeSet author="kopanalk" id="rev-192">
        <comment>
            Add a column in the DATASET table in order to link the superseded datasets to their successors (if this is the case). Refs #29879.
        </comment>
        <addColumn tableName="DATASET">
            <column name="SUCCESSOR" type="INT UNSIGNED"/>
        </addColumn>
        <addForeignKeyConstraint constraintName="FK_SUPERSEDED_SUCCESSOR_DS" baseTableName="DATASET" baseColumnNames="SUCCESSOR" referencedColumnNames="DATASET_ID"  referencedTableName="DATASET"/> 
    </changeSet>

    <changeSet author="stamojoh" id="rev-193">
        <dropUniqueConstraint tableName="VOCABULARY_CONCEPT_ELEMENT" constraintName="UNIQ_ATTR_MD5" />
        <addUniqueConstraint tableName="VOCABULARY_CONCEPT_ELEMENT" columnNames="VOCABULARY_CONCEPT_ID, DATAELEM_ID, ATTR_MD5" constraintName="UNIQ_ATTR_MD5" />
    </changeSet>

    <changeSet id="rev-194" author="vskiadas90">
        <createTable tableName="ASYNC_TASK_ENTRY_HISTORY">
            <column name="ID" type="BIGINT" autoIncrement="true">            
            <constraints nullable="false" primaryKey="true" primaryKeyName="PK_ASYNC_TASK_ENTRY_HISTORY" />
            </column>
            <column name="TASK_ID" type="VARCHAR(200)">
                <constraints nullable="false"  />
            </column>
            <column name="TASK_CLASS_NAME" type="VARCHAR(250)">
                <constraints nullable="false" />
            </column>
            <column name="EXECUTION_STATUS" type="TINYINT">
                <constraints nullable="false" />
            </column>
            <column name="SCHEDULED_DATE" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="START_DATE" type="BIGINT">
                <constraints nullable="true" />
            </column>
            <column name="END_DATE" type="BIGINT">
                <constraints nullable="true" />
            </column>
            <column name="SERIALIZED_PARAMETERS" type="TEXT">
                <constraints nullable="true" />
            </column>
            <column name="SERIALIZED_RESULT" type="TEXT">
                <constraints nullable="true" />
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=InnoDB DEFAULT CHARSET=utf8"/>
        </modifySql>
    </changeSet>

    <changeSet author="stamojoh" id="rev-195">
        <dropTable tableName="ROD_ACTIVITIES" />
        <dropTable tableName="DST2ROD" />
        <dropTable tableName="HARV_ATTR" />
        <dropTable tableName="HARV_ATTR_FIELD" />
        <dropColumn tableName="M_COMPLEX_ATTR" columnName="HARVESTER_ID" />
        <dropColumn tableName="M_COMPLEX_ATTR_FIELD" columnName="HARV_ATTR_FLD_NAME" />
        <dropColumn tableName="COMPLEX_ATTR_ROW" columnName="HARV_ATTR_ID" />		
    </changeSet>

    <changeSet author="stamojoh" id="rev-196">
        <comment>
            Refs #85821 Attributes with vocabulary values should store concept id instead of identifier
        </comment>
        <sql>
            update ATTRIBUTE join M_ATTRIBUTE_VOCABULARY on ATTRIBUTE.M_ATTRIBUTE_ID=M_ATTRIBUTE_VOCABULARY.M_ATTRIBUTE_ID 
                set ATTRIBUTE.VALUE=(select IFNULL((select VOCABULARY_CONCEPT_ID from VOCABULARY_CONCEPT 
            where VOCABULARY_ID=M_ATTRIBUTE_VOCABULARY.VOCABULARY_ID and IDENTIFIER=VALUE), ''));
            delete from ATTRIBUTE where VALUE='' and M_ATTRIBUTE_ID in (select M_ATTRIBUTE_ID from M_ATTRIBUTE_VOCABULARY);
        </sql>
    </changeSet>

    <changeSet author="stamojoh" id="rev-197">
        <comment>
            Refs #85610 Remove complex attributes
        </comment>
        <dropTable tableName="M_COMPLEX_ATTR_FIELD" />
        <dropTable tableName="M_COMPLEX_ATTR" />
        <dropTable tableName="COMPLEX_ATTR_FIELD" />
        <dropTable tableName="COMPLEX_ATTR_ROW" />
    </changeSet>

    <changeSet author="stamojoh" id="rev-198">
        <!--preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="FK_DATAELEM_ID" tableName="INFERENCE_RULE"/>
            </not>
        </preConditions-->
        <comment>
            Refs #85105 In order to drop the primary key in rev-199 
            all the foreign keys must have indexes
        </comment>
        <createIndex indexName="FK_DATAELEM_ID" tableName="INFERENCE_RULE" >
            <column name="DATAELEM_ID" />
        </createIndex>
    </changeSet>

    <changeSet author="stamojoh" id="rev-199">
        <comment>
            Refs #85105 Drop primary key 
            https://bugs.mysql.com/bug.php?id=11305
        </comment>
        <dropPrimaryKey tableName="INFERENCE_RULE"/>
    </changeSet>

  <changeSet author="vskiadas90" id="rev-200">
        <comment>
            Add a column in the DATASET table to be used by admins to decide whether to show or hide EXCEL template download for a dataset. Refs #92071.
        </comment>
        <addColumn tableName="DATASET">
            <column name="ALLOW_EXCEL_DOWNLOAD" type="TINYINT(1)"/>
        </addColumn>
    </changeSet>
   <changeSet author="vskiadas90" id="rev-201">
        <comment>
            Add a column in the DATASET table to be used by admins to decide whether to show or hide MS-access template download for a dataset. Refs #92071.
        </comment>
        <addColumn tableName="DATASET">
            <column name="ALLOW_MSACCESS_DOWNLOAD" type="TINYINT(1)"/>
        </addColumn>
    </changeSet>
    <changeSet author="vskiadas90" id="rev-202">
        <comment>
            Add a column in the DATASET table to persist Dataset Display Download Links checkboxes
        </comment>
        <addColumn tableName="DATASET">
            <column name="DISPLAY_DOWNLOAD_LINKS" type="TEXT"/>
        </addColumn>
    </changeSet>
    <changeSet author="vskiadas90" id="rev-203">
        <dropColumn    columnName="ALLOW_MSACCESS_DOWNLOAD"
                       tableName="DATASET"/>
    </changeSet>
    <changeSet author="vskiadas90" id="rev-204">
        <dropColumn    columnName="ALLOW_EXCEL_DOWNLOAD"
                       tableName="DATASET"/>
    </changeSet>
    <changeSet id="rev-205" author="anthaant">
        <createIndex indexName="VOCABULARY_CONCEPT_ORIGINAL_ID" tableName="VOCABULARY_CONCEPT" >
            <column name="ORIGINAL_CONCEPT_ID" />
        </createIndex>
    </changeSet>
    <changeSet id="rev-206" author="skiadas">
        <dropColumn tableName="API_KEY" columnName="REMOTE_ADDR"/>
    </changeSet>
    <changeSet id="rev-207" author="anthaant">
        <comment>Remove the table for api key that became obsolete</comment>
        <dropTable tableName="API_KEY"/>
    </changeSet>
    <changeSet author="skiadas" id="rev-208">
        <addDefaultValue
                columnName="LANGUAGE"
                defaultValue=""
                tableName="VOCABULARY_CONCEPT_ELEMENT"/>
        <comment>Change default value</comment>
    </changeSet>
</databaseChangeLog>
